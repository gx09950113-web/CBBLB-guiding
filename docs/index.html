<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>錢包比臉薄｜百業首頁</title>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>

<body class="page-home">
  <!-- 背景音樂 -->
  <audio id="bgm" preload="auto" loop playsinline>
    <source src="assets/sounds/index.mp3" type="audio/mpeg" />
  </audio>

  <!-- LOGO 置中置頂 -->
  <header class="top-logo">
    <img class="logo-main" src="assets/img/WTTF-LOGO.png" alt="錢包比臉薄 LOGO" />

    <div class="top-actions">
      <button id="muteBtn" class="btn btn-ghost" type="button" aria-pressed="false" title="靜音 / 取消靜音">
        🔊 聲音：開
      </button>
    </div>
  </header>

  <main class="container">
    <section class="card hero">
      <h1 class="title">錢包比臉薄</h1>
      <p class="subtitle">大亞洲地區玩家歡迎，請以中文為主進行交流。</p>

      <div class="divider"></div>

      <div class="intro">
        <p>每週貨運做好做滿，掛在駐地閒聊瞎晃，搞搞活躍度。</p>
        <p><strong>百業派對 22：00 開始。</strong></p>

        <ul class="rules">
          <li><strong>3 天未上線</strong> → 列入觀察。</li>
          <li><strong>7 天未上線</strong> → 直接踢。</li>
          <li><strong>連續兩周活躍度不足 1000 以上</strong> → 直接踢。</li>
        </ul>
      </div>

      <p id="autoplayHint" class="hint" hidden>
        ⚠️ 你的瀏覽器阻擋自動播放。點一下頁面或按「聲音：開」即可開始播放。
      </p>
    </section>

    <nav class="navgrid" aria-label="主要導覽">
      <a class="navbtn" href="index.html">首頁</a>
      <a class="navbtn" href="philosophy.html">百業理念</a>
      <a class="navbtn" href="members.html">活躍成員</a>
      <a class="navbtn" href="events.html">荷包活動</a>
      <a class="navbtn" href="schedule.html">百業行程</a>
      <a class="navbtn" href="links.html">外部連結</a>
    </nav>
  </main>

  <footer class="footer">
    <small>© 錢包比臉薄</small>
  </footer>

  <script>
    (() => {
      // ================================
      // Global BGM Guard（切頁不重疊）
      // ================================
      const BGM_KEY = "WTTF_ACTIVE_BGM";
      const CURRENT_BGM = "index";

      const audio = document.getElementById("bgm");
      const muteBtn = document.getElementById("muteBtn");
      const hint = document.getElementById("autoplayHint");

      if (!audio) return;

      // 0~1 線性音量，使用 0.15 作為「偏小聲」預設
      audio.volume = 0.15;

      function setMuted(isMuted) {
        audio.muted = isMuted;
        if (muteBtn) {
          muteBtn.setAttribute("aria-pressed", String(isMuted));
          muteBtn.textContent = isMuted ? "🔇 聲音：關" : "🔊 聲音：開";
        }
      }

      // 預設開聲音
      setMuted(false);

      function shouldPlayHere() {
        const active = sessionStorage.getItem(BGM_KEY);
        // 如果 session 指定的是別頁（例如 members），index 不介入播放
        return !(active && active !== CURRENT_BGM);
      }

      async function tryPlay() {
        // 不該在 index 播：直接停掉、也不顯示提示
        if (!shouldPlayHere()) {
          audio.pause();
          if (hint) hint.hidden = true;
          return;
        }

        // 只有確定要由 index 播時才宣告 active=index
        sessionStorage.setItem(BGM_KEY, CURRENT_BGM);

        try {
          await audio.play();
          if (hint) hint.hidden = true;
        } catch (e) {
          if (hint) hint.hidden = false;
        }
      }

      // 點靜音鍵切換；同時嘗試播放（使用者互動通常可解鎖播放）
      if (muteBtn) {
        muteBtn.addEventListener("click", async () => {
          setMuted(!audio.muted);
          await tryPlay();
        });
      }

      // 點一下頁面也嘗試解鎖播放（手機更穩）
      document.addEventListener("pointerdown", async () => {
        if (audio.paused) await tryPlay();
      }, { once: true });

      // 切頁/切分頁：離開就停，避免重疊
      document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
          audio.pause();
        } else {
          tryPlay();
        }
      });

      // 初次嘗試播放
      tryPlay();
    })();
  </script>
</body>
</html>
